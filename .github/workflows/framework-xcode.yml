name: Build iOS Framework

on:
  push:
    branches:
      - main  # Adjust the branch name as per your needs

jobs:
  build:
    runs-on: macos-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Build iphoneos
        run: |
          rm -rf build
          xcodebuild archive \
            -scheme CalendarControl \
            -configuration Release \
            -destination 'generic/platform=iOS' \
            -archivePath './build/CalendarControl.framework-iphoneos.xcarchive' \
            SKIP_INSTALL=NO \
            BUILD_LIBRARIES_FOR_DISTRIBUTION=YES
            
      - name: Build iphonesimulator
        run: |
          xcodebuild archive \
            -scheme CalendarControl \
            -configuration Release \
            -destination 'generic/platform=iOS Simulator' \
            -archivePath './build/CalendarControl.framework-iphonesimulator.xcarchive' \
            SKIP_INSTALL=NO \
            BUILD_LIBRARIES_FOR_DISTRIBUTION=YES

      - name: Build iOS Framework
        run: |
          xcodebuild -create-xcframework \
            -framework './build/CalendarControl.framework-iphonesimulator.xcarchive/Products/Library/Frameworks/CalendarControl.framework' \
            -framework './build/CalendarControl.framework-iphoneos.xcarchive/Products/Library/Frameworks/CalendarControl.framework' \
            -output './build/CalendarControl.xcframework'
      - name: Setting up Git
        run: |
          git config user.name sudhanshublah  
          git config user.email sudhanshuk1219@gmail.com
          
      - name: Push changes
        uses: ad-m/github-push-action@master
        with:
          github_token: "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"
          branch: ${{ github.ref }}
      - uses: fastify/github-action-merge-dependabot@v2.1.1
        with:
          github-token: "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"
